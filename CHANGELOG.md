# –ê–Ω–∞–ª–∏–∑ –∏ —É–ª—É—á—à–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ Log Manager

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ root-–ø—Ä–∞–≤
**–ë—ã–ª–æ:** –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–ª—Å—è –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏, –ø–∞–¥–∞–ª —Å –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏
**–°—Ç–∞–ª–æ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –Ω–∞—á–∞–ª–µ —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º

### 2. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ cron-–∑–∞–¥–∞—á
**–ë—ã–ª–æ:**
```bash
(sudo crontab -l 2>/dev/null; echo "0 3 * * * ...") | sudo crontab -
```
–ö–∞–∂–¥—ã–π –∑–∞–ø—É—Å–∫ –ø—É–Ω–∫—Ç–∞ 4 –¥–æ–±–∞–≤–ª—è–ª –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏!

**–°—Ç–∞–ª–æ:**
```bash
if ! echo "$current_cron" | grep -qF "logrotate -f"; then
    # –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç
fi
```

### 3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ journald.conf
**–ë—ã–ª–æ:** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–±–∞–≤–ª—è–ª–∏—Å—å –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ –∫–∞–∂–¥—ã–π —Ä–∞–∑
**–°—Ç–∞–ª–æ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º

### 4. –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —á–∏—Å–µ–ª
**–ë—ã–ª–æ:**
```bash
syslog_size=$(sudo du -m /var/log/syslog | cut -f1)
if [ "$syslog_size" -gt 100 ]; then  # —É–ø–∞–¥—ë—Ç –µ—Å–ª–∏ du –≤–µ—Ä–Ω—ë—Ç –æ—à–∏–±–∫—É
```
**–°—Ç–∞–ª–æ:**
```bash
get_file_size_mb() {
    local size=$(du -m "$file" 2>/dev/null | cut -f1)
    if [[ "$size" =~ ^[0-9]+$ ]]; then
        echo "$size"
    else
        echo "0"
    fi
}
```

---

## üü° –°—Ä–µ–¥–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### 5. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π
–î–æ–±–∞–≤–ª–µ–Ω —Ñ–∞–π–ª –∂—É—Ä–Ω–∞–ª–∞ `/var/log/log_manager.log`:
```bash
log_action "ACTION" "–û—á–∏—â–µ–Ω $file (–±—ã–ª–æ ${size_before}MB)"
```

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
check_dependencies() {
    # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ: truncate, find, du, df, journalctl, logrotate
    # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ: ncdu, watch
}
```

### 7. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ø–æ—Ä–æ–≥–∏
```bash
SYSLOG_THRESHOLD=100
AUTH_THRESHOLD=50
JOURNAL_SIZE="200M"
```
–ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —á–µ—Ä–µ–∑ –º–µ–Ω—é –∏–ª–∏ —Ñ–∞–π–ª `/etc/log_manager.conf`

### 8. DRY-RUN —Ä–µ–∂–∏–º
```bash
./log_manager_v2.sh --dry-run
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ, –Ω–æ –Ω–µ –¥–µ–ª–∞–µ—Ç

---

## üü¢ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `--dry-run` | –ó–∞–ø—É—Å–∫ –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| `--verbose` | –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ |
| –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è | –ö—Ä–∏—Ç–∏—á–Ω–æ/–í–Ω–∏–º–∞–Ω–∏–µ/OK –¥–ª—è —Ä–∞–∑–º–µ—Ä–æ–≤ |
| –í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä | –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–∞ |
| –ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ | –ü—É–Ω–∫—Ç 9 –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ | `lsof | grep deleted` |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ SSH | –û—Ç–¥–µ–ª—å–Ω—ã–π –ø—É–Ω–∫—Ç |
| –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤ | –° –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ logrotate | –î–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤ |

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –ê—Å–ø–µ–∫—Ç | v1.0 | v2.0 |
|--------|------|------|
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | ~350 | ~700 |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ root | ‚ùå | ‚úÖ |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚ùå | ‚úÖ |
| –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π | ‚ùå | ‚úÖ |
| Dry-run —Ä–µ–∂–∏–º | ‚ùå | ‚úÖ |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | Hardcoded | –§–∞–π–ª + –º–µ–Ω—é |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | –ë–∞–∑–æ–≤–∞—è | –ü–æ–ª–Ω–∞—è |
| –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è | –ë–∞–∑–æ–≤–∞—è | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è |

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
# –û–±—ã—á–Ω—ã–π –∑–∞–ø—É—Å–∫
sudo ./log_manager_v2.sh

# –†–µ–∂–∏–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (–Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ—Ç)
sudo ./log_manager_v2.sh --dry-run

# –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
sudo ./log_manager_v2.sh --verbose

# –°–ø—Ä–∞–≤–∫–∞
./log_manager_v2.sh --help
```

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —É–ª—É—á—à–µ–Ω–∏—é

1. **Email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏
2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram/Slack** –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤
3. **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫** –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –¥–∏—Å–∫–∞ –Ω–∞ 90%
5. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Docker** –ª–æ–≥–æ–≤
6. **–ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω** —Ä–æ—Å—Ç–∞ (–∫–∞–∫–æ–π —Å–µ—Ä–≤–∏—Å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ª–æ–≥–∏)
